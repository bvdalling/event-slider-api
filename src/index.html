<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Event Slider Control Panel</title>
  <script src="/socket.io/socket.io.js"></script>
  <style>
    /* Simple styling for clarity */
    .form-group {
      margin: 20px;
    }

    .button-group {
      margin-top: 10px;
    }
  </style>
</head>

<body>
  <main>
    <div class="form-group">

      <div class="input-group d-none">
        <label for="api-key">API KEY</label>
        <input type="password" name="api-key" id="api-key" />
      </div>

      <div class="input-group">
        <label for="video:url">Video URL</label>
        <input type="url" name="video:url" id="video:url" />
        <div class="button-group">
          <button id="video:start">Start</button>
          <button id="video:stop">Stop</button>
        </div>
      </div>

      <div class="input-group">
        <label for="audio:url">Audio URL</label>
        <select name="audio:url:select" id="audio:url:select">
          <option value="">Select Audio</option>
        </select>
        <input type="url" name="audio:url" id="audio:url" />
        <div class="button-group">
          <button id="audio:start">Start</button>
          <button id="audio:stop">Stop</button>
        </div>
      </div>

      <div class="input-group">
        <label for="">QR Code</label>
        <div class="button-group">
          <button id="small-qr">Small</button>
          <button id="large-qr">Large</button>
        </div>
      </div>

      <div class="input-group">
        <label for="">Dashboard Alert</label>
        <div>
          <select name="alert" id="alert:type">
            <option value="success">Success</option>
            <option value="info">Info</option>
            <option value="warning">Warning</option>
            <option value="danger">Danger</option>
          </select>
          <input type="text" name="alert:message" id="alert:message" />
        </div>
      </div>
    </div>
  </main>
  <script>

    let socket;
    let socketAddr = window.location.origin.replace('https', 'wss').replace('http', 'wss')

    const audioEmbeds = [
      { name: '8-bit - Chill', url: 'https://www.youtube.com/embed/videoseries?si=VEkW2Cv5iDy_Ghv2&amp;list=PLdsGes2mFh92eHpOZVJQgoubb6rF0CcvU' },
      { name: 'Chillwave - Synthwave - Retrowave', url: 'https://www.youtube.com/embed/videoseries?si=wVLbmMrEIAed2DBn&amp;list=PLOtNYlNIGer0jmWpFtTWqMkfP56iuZg1w' },
      { name: 'Party Music', url: 'https://www.youtube.com/embed/videoseries?si=TzDspRUNwbp9tZMi&amp;list=PLfP6i5T0-DkLpeFGWN6BYbzZDDqzMMBY9' },
      { name: 'Lounge Music', url: 'https://www.youtube.com/embed/videoseries?si=ibQDnfCcto1xxiAN&amp;list=PLfP6i5T0-DkIqfFWnaxioU7PCcW9jZe3Q' },
      { name: 'Final Countdown', url: 'https://www.youtube.com/embed/cZid3J36wH8?si=ygccJtU19hH9Kyvg' },
      { name: 'Tron Soundtrack', url: 'https://www.youtube.com/embed/videoseries?si=HPLXU889uVBNI7Kt&amp;list=PLO6S2qKFLclrN-u7V2Wag7-C6rfgpWzG2' }
    ];

    const initializeSocket = (apiKey) => {
      if (socket) {
        socket.disconnect();
      }

      socket = io(socketAddr, {
        auth: { token: apiKey },
      });

      // Event listeners for server responses
      socket.on("video:start", (data) => {
        console.log("Video started:", data);
      });

      socket.on("video:stop", (data) => {
        console.log("Video stopped:", data);
      });

      socket.on("video:pause", (data) => {
        console.log("Video paused:", data);
      });
    };

    // Event handler for API key input change
    const apiKeyInput = document.getElementById("api-key");
    apiKeyInput.onchange = (e) => {
      const newApiKey = e.target.value;
      initializeSocket(newApiKey);
    };

    // Prefill audio URLs
    const audioUrlSelect = document.getElementById("audio:url:select");
    audioEmbeds.forEach((audioEmbed) => {
      const option = document.createElement("option");
      option.value = audioEmbed.url;
      option.text = audioEmbed.name;
      audioUrlSelect.appendChild(option);
    });

    // Update audio URL input when selection changes
    audioUrlSelect.onchange = (e) => {
      const audioUrl = e.target.value;
      document.getElementById("audio:url").value = audioUrl;
    };

    // Button event listeners
    document.getElementById("video:start").onclick = () => {
      const videoUrl = document.getElementById("video:url").value;
      const url = `https://www.youtube.com/embed/${videoUrl}`
        .replace("https://www.youtube.com/watch?v=", "")
        .replace("https://youtu.be/", "")
        .replace("https://m.youtube.com/watch?v=", "");

      console.log("Sending Video", url, "to socket", socketAddr);
      socket.emit("video-start", { url: url });
    };

    document.getElementById("video:stop").onclick = () => {
      socket.emit("video-stop", {});
    };

    document.getElementById("audio:start").onclick = () => {
      const audioUrl = document.getElementById("audio:url").value;
      console.log("Sending Audio", audioUrl);
      socket.emit("audio-start", { url: audioUrl });
    };

    document.getElementById("audio:stop").onclick = () => {
      socket.emit("audio-stop", {});
    };

    document.getElementById("small-qr").onclick = () => {
      socket.emit("qr-code", 'qr-code');
    };

    document.getElementById("large-qr").onclick = () => {
      socket.emit("qr-code", 'qr-code qr-code__large');
    };

    document.getElementById("alert:message").onchange = (e) => {
      const alertType = document.getElementById("alert:type").value;
      const alertMessage = e.target.value;
      socket.emit("alert-msg", { type: alertType, message: alertMessage });
    };

    // Initial socket connection with a default API key if available
    const defaultApiKey = window.localStorage.getItem("api-key");

    if (!defaultApiKey || defaultApiKey == "null") {
      window.localStorage.setItem(prompt("Enter the API Key."))
    }
    
    initializeSocket(defaultApiKey);

  </script>

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
    }
    
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background-color: #f4f6f8;
    }
    
    main {
      width: 100%;
      max-width: 400px;
      padding: 20px;
      background-color: #ffffff;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    
    .form-group {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    
    .input-group label {
      font-weight: bold;
      color: #333;
      margin-bottom: 5px;
    }
    
    .input-group {
      display: flex;
      flex-direction: column;
    }
    
    input[type="password"],
    input[type="url"],
    select,
    input[type="text"] {
      width: 100%;
      padding: 10px;
      border: 1px solid #d1d9e0;
      border-radius: 4px;
      font-size: 14px;
      color: #333;
    }
    
    input:focus,
    select:focus {
      outline: none;
      border-color: #4a90e2;
      box-shadow: 0 0 4px rgba(74, 144, 226, 0.4);
    }
    
    .button-group {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }
    
    button {
      flex: 1;
      padding: 10px;
      border: none;
      border-radius: 4px;
      font-size: 14px;
      cursor: pointer;
      color: #ffffff;
      transition: background-color 0.2s;
    }
    
    button#video\:start,
    button#audio\:start,
    button#small-qr,
    button#large-qr {
      background-color: #4a90e2;
    }
    
    button#video\:stop,
    button#audio\:stop {
      background-color: #d9534f;
    }
    
    button:hover {
      opacity: 0.9;
    }
    
    button:focus {
      outline: none;
      box-shadow: 0 0 4px rgba(74, 144, 226, 0.4);
    }
    
    select {
      background-color: #ffffff;
      padding: 10px;
      border: 1px solid #d1d9e0;
      border-radius: 4px;
      font-size: 14px;
      color: #333;
    }
    
    #alert\:message {
      width: 100%;
      padding: 10px;
      border: 1px solid #d1d9e0;
      border-radius: 4px;
      font-size: 14px;
      color: #333;
    }
    
    #alert\:type {
      margin-top: 5px;
    }
    
  </style>
</body>

</html>
